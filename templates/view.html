{% extends "base.html" %}
{% block title %}QuoteType â€” Poster {{ poster_id }}{% endblock %}
{% block body %}
<div class="viewwrap">
  <header class="viewbar">
    <div>QuoteType</div>
    <div class="spacer"></div>
    <a class="btn" href="/">Create your own</a>
  </header>

  <main class="panel stage-wrap">
    <div id="stage" class="stage {{ payload.gradient }}">
      <div id="chrome" class="chrome {% if not payload.frame %}hidden{% endif %}"></div>
      <div id="poster" class="poster {% if payload.shadow %}shadow-soft{% endif %}" style="width:{{ payload.width }}px;height:{{ payload.height }}px;padding:{{ payload.padding }}px">
        <img src="{{ payload.image }}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" />
      </div>
    </div>
  </main>

  <div class="actions center">
    <button class="btn" id="downloadPng">Download PNG</button>
    <button class="btn" id="copyPng">Copy image</button>
  </div>
</div>
<script>
  async function makeCanvas(){
    const node = document.getElementById('stage');
    const canvas = await html2canvas(node, {backgroundColor: null, scale: 2});
    return canvas;
  }
  document.getElementById('downloadPng').onclick = async ()=>{
    const c = await makeCanvas();
    const a = document.createElement('a');
    a.href = c.toDataURL('image/png'); a.download = 'quote-poster.png'; a.click();
  }
  document.getElementById('copyPng').onclick = async ()=>{
    const c = await makeCanvas();
    c.toBlob(async (blob)=>{
      try{ await navigator.clipboard.write([new ClipboardItem({'image/png': blob})]); alert('Copied to clipboard!'); }
      catch(e){ alert('Copy blocked by browser. Download instead.'); }
    })
  }
</script>
{% endblock %}
